<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Map Editor</title>
  <style>
    canvas { border: 1px solid #ccc; cursor: crosshair; }
    body { font-family: sans-serif; }
  </style>
</head>
<body>
<h2>Map Editor</h2>
<canvas id="editorCanvas" width="640" height="640"></canvas>
<p>Links-Klick: Boden (0) – Rechts-Klick: Wand (1) – Taste S: Speichern</p>

<script>
  const canvas = document.getElementById("editorCanvas");
  const ctx = canvas.getContext("2d");

  const cols = 20;
  const rows = 20;
  const tileSize = 32;

  const map = Array.from({ length: rows }, () =>
    Array.from({ length: cols }, () => 1) // Standard: alles Wand
  );

  function drawGrid() {
    for (let y = 0; y < rows; y++) {
      for (let x = 0; x < cols; x++) {
        ctx.fillStyle = map[y][x] === 0 ? "#ddd" : "#333";
        ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
        ctx.strokeStyle = "#888";
        ctx.strokeRect(x * tileSize, y * tileSize, tileSize, tileSize);
      }
    }
  }

  function getMousePos(evt) {
    const rect = canvas.getBoundingClientRect();
    return {
      x: Math.floor((evt.clientX - rect.left) / tileSize),
      y: Math.floor((evt.clientY - rect.top) / tileSize),
    };
  }

  canvas.addEventListener("contextmenu", e => e.preventDefault());

  canvas.addEventListener("mousedown", (e) => {
    const { x, y } = getMousePos(e);
    if (x >= 0 && y >= 0 && x < cols && y < rows) {
      map[y][x] = e.button === 2 ? 1 : 0; // Rechts = Wand, Links = Boden
      drawGrid();
    }
  });

  document.addEventListener("keydown", e => {
    if (e.key.toLowerCase() === "s") {
      const json = JSON.stringify({ map }, null, 2);
      const blob = new Blob([json], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "maps.json";
      a.click();
    }
  });

  drawGrid();
</script>
</body>
</html>
